<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MDT | MOBILE HQ</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #05080f; color: #f1f5f9; overflow: hidden; height: 100vh; position: fixed; width: 100%; }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø§Ù†ÙŠÙ…ÙŠØ´Ù† */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø§Ù„Ø®Ø§Øµ */
        .mobile-card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(59, 130, 246, 0.1); border-radius: 16px; transition: 0.3s; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 75px; background: #0f172a; border-top: 1px solid #1e293b; display: flex; justify-content: space-around; align-items: center; z-index: 2000; padding-bottom: env(safe-area-inset-bottom); }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #64748b; font-size: 10px; font-weight: 700; transition: 0.3s; }
        .nav-btn.active { color: #3b82f6; }
        .nav-btn i { font-size: 20px; }

        .header-glass { position: fixed; top: 0; left: 0; right: 0; height: 65px; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px); z-index: 1000; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid rgba(59, 130, 246, 0.2); }
        
        input, select, textarea { background: #1e293b !important; border: 1px solid #334155 !important; color: white !important; border-radius: 12px; padding: 14px; width: 100%; outline: none; appearance: none; }
        
        .main-container { height: 100vh; overflow-y: auto; padding: 80px 15px 100px 15px; scroll-behavior: smooth; }
        
        /* Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ø¦Ù… */
        .fab { position: fixed; bottom: 90px; left: 20px; width: 55px; height: 55px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); z-index: 1500; font-size: 24px; color: white; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
        
        const firebaseConfig = { 
            apiKey: "AIzaSyCYgffN2dA7IILMbI2i_1YfERkKWIrpHyA", 
            authDomain: "ek-police.firebaseapp.com", 
            projectId: "ek-police", 
            storageBucket: "ek-police.firebasestorage.app", 
            messagingSenderId: "300605258409", 
            appId: "1:300605258409:web:f265025ffa5592f651c7b8" 
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.fb = { db, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, updateDoc, serverTimestamp };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [page, setPage] = useState('dashboard');
            const [users, setUsers] = useState([]);
            const [wanted, setWanted] = useState([]);
            const [reports, setReports] = useState([]);
            const [modal, setModal] = useState(null);

            useEffect(() => {
                if (!window.fb) return;
                const db = window.fb.db;
                window.fb.onSnapshot(window.fb.collection(db, "users"), s => setUsers(s.docs.map(d => ({...d.data(), fbId: d.id}))));
                window.fb.onSnapshot(window.fb.collection(db, "wanted"), s => setWanted(s.docs.map(d => ({...d.data(), fbId: d.id}))));
                window.fb.onSnapshot(window.fb.query(window.fb.collection(db, "field_reports"), window.fb.orderBy("createdAt", "desc")), s => setReports(s.docs.map(d => ({...d.data(), fbId: d.id}))));
            }, []);

            const handleLogin = () => {
                const id = document.getElementById('l_id').value;
                const pw = document.getElementById('l_pw').value;
                const u = users.find(x => x.id === id && x.password === pw);
                if(u) { setCurrentUser(u); setIsLoggedIn(true); } else alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
            };

            if (!isLoggedIn) return (
                <div className="h-screen w-full flex items-center justify-center p-6 bg-[#05080f]">
                    <div className="w-full max-w-sm space-y-8 fade-in">
                        <div className="text-center">
                            <div className="w-24 h-24 bg-blue-600/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-blue-500/20">
                                <i className="fas fa-shield-halved text-4xl text-blue-500"></i>
                            </div>
                            <h1 className="text-3xl font-black italic text-blue-500">MDT MOBILE</h1>
                            <p className="text-gray-500 text-sm">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</p>
                        </div>
                        <div className="space-y-4">
                            <input id="l_id" type="number" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ" className="text-center" />
                            <input id="l_pw" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" className="text-center" />
                            <button onClick={handleLogin} className="w-full bg-blue-600 py-4 rounded-2xl font-black uppercase tracking-widest shadow-lg shadow-blue-600/20 active:scale-95 transition-all">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="relative h-screen">
                    <header className="header-glass">
                        <div className="flex items-center gap-3">
                            <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-xs font-black italic">M</div>
                            <span className="font-black italic text-sm tracking-tighter uppercase">{page}</span>
                        </div>
                        <div className="text-left">
                            <p className="text-[10px] text-blue-500 font-black leading-none uppercase">{currentUser.rank}</p>
                            <p className="text-xs font-bold">{currentUser.name}</p>
                        </div>
                    </header>

                    <main className="main-container">
                        {page === 'dashboard' && (
                            <div className="space-y-6 fade-in">
                                <div className="mobile-card p-6 border-r-4 border-blue-500">
                                    <h2 className="text-gray-400 text-xs font-bold mb-1">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù‚ÙˆØ©</h2>
                                    <div className="flex justify-between items-end">
                                        <p className="text-4xl font-black">{users.length}</p>
                                        <i className="fas fa-users text-blue-500/20 text-4xl"></i>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div className="mobile-card p-4 border-r-4 border-red-500">
                                        <h3 className="text-[10px] font-bold text-gray-400">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†</h3>
                                        <p className="text-2xl font-black">{wanted.length}</p>
                                    </div>
                                    <div className="mobile-card p-4 border-r-4 border-amber-500">
                                        <h3 className="text-[10px] font-bold text-gray-400">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
                                        <p className="text-2xl font-black">{reports.length}</p>
                                    </div>
                                </div>

                                <div className="space-y-3">
                                    <h3 className="text-sm font-black mr-1">Ø£Ø­Ø¯Ø« Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ… ğŸš¨</h3>
                                    {wanted.slice(0, 2).map(w => (
                                        <div key={w.fbId} className="mobile-card p-3 flex items-center gap-4">
                                            <img src={w.photo} className="w-12 h-12 rounded-xl object-cover" />
                                            <div>
                                                <p className="font-black text-sm text-red-500">{w.name}</p>
                                                <p className="text-[10px] text-gray-400">{w.charge}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {page === 'wanted' && (
                            <div className="space-y-4 fade-in">
                                <h1 className="text-2xl font-black">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†</h1>
                                {wanted.map(w => (
                                    <div key={w.fbId} className="mobile-card overflow-hidden">
                                        <img src={w.photo} className="w-full h-48 object-cover" />
                                        <div className="p-4 flex justify-between items-center">
                                            <div>
                                                <h3 className="font-black text-red-500">{w.name}</h3>
                                                <p className="text-xs text-gray-400">{w.charge}</p>
                                            </div>
                                            <button className="bg-red-600/10 text-red-500 p-2 rounded-lg text-xs font-bold">ØªÙØ§ØµÙŠÙ„</button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {page === 'reports' && (
                            <div className="space-y-4 fade-in">
                                <h1 className="text-2xl font-black">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©</h1>
                                <div className="mobile-card p-4 space-y-3">
                                    <textarea id="r_content" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§Øº Ù‡Ù†Ø§..." className="h-24 text-sm"></textarea>
                                    <button onClick={async()=>{
                                        const val = document.getElementById('r_content').value;
                                        if(!val) return;
                                        await window.fb.addDoc(window.fb.collection(window.fb.db, "field_reports"), {
                                            content: val, author: currentUser.name, createdAt: window.fb.serverTimestamp()
                                        });
                                        document.getElementById('r_content').value = '';
                                    }} className="w-full bg-blue-600 py-3 rounded-xl font-black text-sm">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                                </div>
                                {reports.map(r => (
                                    <div key={r.fbId} className="mobile-card p-4 border-r-2 border-blue-500">
                                        <div className="flex justify-between mb-2">
                                            <span className="text-[10px] font-black text-blue-400">{r.author}</span>
                                            <span className="text-[10px] text-gray-600">Ù…Ù†Ø° Ù‚Ù„ÙŠÙ„</span>
                                        </div>
                                        <p className="text-xs text-gray-300 leading-relaxed">{r.content}</p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    <nav className="bottom-nav">
                        <div onClick={()=>setPage('dashboard')} className={`nav-btn ${page==='dashboard'?'active':''}`}>
                            <i className="fas fa-home"></i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                        </div>
                        <div onClick={()=>setPage('wanted')} className={`nav-btn ${page==='wanted'?'active':''}`}>
                            <i className="fas fa-skull-crossbones"></i><span>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†</span>
                        </div>
                        <div onClick={()=>setPage('reports')} className={`nav-btn ${page==='reports'?'active':''}`}>
                            <i className="fas fa-file-signature"></i><span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
                        </div>
                        <div onClick={()=>setIsLoggedIn(false)} className="nav-btn text-red-500">
                            <i className="fas fa-power-off"></i><span>Ø®Ø±ÙˆØ¬</span>
                        </div>
                    </nav>

                    {/* Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø³Ø±ÙŠØ¹ */}
                    {page === 'wanted' && (
                        <div className="fab" onClick={() => alert('Ø³ÙŠØªÙ… ÙØªØ­ ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ©')}>
                            <i className="fas fa-plus"></i>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
